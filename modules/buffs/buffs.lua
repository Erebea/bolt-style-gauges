-- rgb colours of buff and debuff outlines
local buffr = 90
local buffg = 150
local buffb = 25
local debuffr = 204
local debuffg = 0
local debuffb = 0

-- converts a number in the range 0-1 to an integer in the range 0-255
local function roundcol (c)
  return math.floor((c * 255.0) + 0.5)
end

-- value multiplier that each letter represents that can appear in buff text
local multipliers = { h = 3600, k = 1000, m = 60 }

-- handlers for every valid character in buff text
local emptyhandler = function () end
local handlers = {
  r = emptyhandler, -- 'r' appears only in 'hr', so we handle 'h' as a multiplier (3600) and ignore 'r's
  ['%'] = emptyhandler,
  ['('] = function (details)
    -- note: '(' and ')' will both lead to this handler, because we don't read enough pixels to
    -- differentiate the two in some fonts, and we also don't need to.
    if details.parens == nil then details.parens = 0 end
  end,
}
for k, v in pairs(multipliers) do
  handlers[k] = function (details)
    if details.parens ~= nil then
      details.parens = details.parens * v
    elseif details.number ~= nil then
      details.number = details.number * v
    end
  end
end
for i = 0, 9 do
  handlers[i] = function (details)
    if details.parens ~= nil then
      details.parens = i + (details.parens * 10)
    elseif details.number ~= nil then
      details.number = i + (details.number * 10)
    else
      details.number = i
    end
  end
end


return {
  -- tries to parse the details of a buff or debuff on the screen.
  --
  -- parameters:
  -- `this`: the object returned by require() when importing this module (use the ':' operator)
  -- `event`: the render2d event possibly containing a buff or debuff
  -- `startindex`: the index of the image immediately after the image that's suspected of being a
  -- buff or debuff, or 1 if the suspected image was seen in a previous event (i.e. onrendericon)
  -- pxleft, pxtop: the top-left corner that the suspected image was drawn at (given by vertextargetxy)
  --
  -- returns up to 4 values:
  -- 1. true if this is a buff or debuff, false otherwise. if false, all following values are nil.
  -- 2. the number appearing on the buff, if any. this function will multiply the returned value by
  -- 60 for 'm', 3600 for 'hr', or 1000 for 'k' if any of those appear in the text. if no text appears
  -- at all, this will be nil.
  -- 3. the number appearing in parentheses on the buff, if any. if there are no parentheses, this
  -- wil be nil.
  -- 4. `true` if this is a buff (green), `false` if this is a debuff (red).
  --
  -- example.png, in this repo, shows a buff that would return: true, 27, 1, true
  tryreadbuffdetails = function (this, event, startindex, pxleft, pxtop)
    local vertexcount = event:vertexcount()
    local verticesperimage = event:verticesperimage()
    local details = {} -- details.number and details.parens both start as nil

    -- font characters are always double-rendered (black drop-shadow followed by same character in the
    -- intended colour), so we always want to skip reading every second image: step = verticesperimage * 2
    for i = startindex, vertexcount, verticesperimage * 2 do
      -- check if this is a solid-colour rectangle instead of an image
      local u, v = event:vertexuv(i)
      if u == nil or v == nil then
        -- check if this can be identified as a buff outline. if so, there are no more details to
        -- read past that, so just find out if it's a red or green outline and then return true.
        -- on the other hand, if it's not an outline, this wasn't a buff/debuff at all, so return false.
        local x, y = event:vertexxy(i + 2)
        if x == pxleft and y == pxtop then
          local fr, fg, fb = event:vertexcolour(i)
          local rfr, rfg, rfb = roundcol(fr), roundcol(fg), roundcol(fb)
          if rfr == buffr and rfg == buffg and rfb == buffb then
            return true, details.number, details.parens, true
          elseif rfr == debuffr and rfg == debuffg and rfb == debuffb then
            return true, details.number, details.parens, false
          end
        end
        return false
      end

      -- try to find this character
      local char = this:lookupchar(event, event:vertexatlasdetails(i))
      local handler = handlers[char]
      if not handler then return false end
      handler(details)
    end
    return false
  end,

  -- given some atlas coordinates and a render2d event, looks up a character in the buff text font.
  -- returns a number 0-9, or a string containing exactly 1 character, or nil.
  -- the '(' or ')' characters will both always return '('.
  -- ax,ay,aw,ah are the first four values returned by event:vertexatlasdetails
  lookupchar = function (this, event, ax, ay, aw, ah)
    -- font size constraints, also serves as a safety check for the `texturedata` call
    if aw < 4 or aw > 13 or ah < 7 or ah > 12 then return nil end
    local char = this.buffchars[event:texturedata(ax, ay + 6, aw * 4)]
    if type(char) == "table" then
      char = char[event:texturedata(ax, ay + 1, aw * 4)]
    end
    return char
  end,

  -- lookup table of the 7th row (1-indexed, so y+6) of pixels in each character that can appear on a buff or debuff.
  -- if the result is a table, it's a table of the 2nd row (y+1).
  -- four different fonts can appear depending on settings: small, medium, large, and bold.
  -- note: '(' and ')' will both return '(' from this table, since we don't read enough pixels to tell the difference
  -- between the two in some fonts, and we don't need to differentiate the two in order to read buffs correctly.
  buffchars = {
    ['\xff\xff\xff\x00\xff\xff\xff\xed\xff\xff\xff\x21\xff\xff\xff\x00\xff\xff\xff\x54\xff\xff\xff\xc2'] = {
      ['\xff\xff\xff\x00\xff\xff\xff\xae\xff\xff\xff\x88\xff\xff\xff\x0a\xff\xff\xff\xb6\xff\xff\xff\x73'] = 0,
    },
    ['\xff\xff\xff\x01\xff\xff\xff\xed\xff\xff\xff\x38\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x6e\xff\xff\xff\xc3'] = {
      ['\xff\xff\xff\x00\xff\xff\xff\xa0\xff\xff\xff\xb5\xff\xff\xff\x0e\xff\xff\xff\x20\xff\xff\xff\xdc\xff\xff\xff\x63'] = 0,
    },
    ['\xff\xff\xff\x16\xff\xff\xff\xff\xff\xff\xff\x22\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x53\xff\xff\xff\xe8\xff\xff\xff\x00'] = {
      ['\xff\xff\xff\x00\xff\xff\xff\x94\xff\xff\xff\xd1\xff\xff\xff\x32\xff\xff\xff\x46\xff\xff\xff\xee\xff\xff\xff\x53\xff\xff\xff\x00'] = 0,
    },
    ['\xff\xff\xff\xe4\xff\xff\xff\xea\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x1b\xff\xff\xff\xff\xff\xff\xff\xb3'] = {
      ['\xff\xff\xff\x48\xff\xff\xff\xff\xff\xff\xff\xd7\xff\xff\xff\x8f\xff\xff\xff\xeb\xff\xff\xff\xf1\xff\xff\xff\x18'] = 0,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x24\xff\xff\xff\xf4'] = {
      ['\xff\xff\xff\x0e\xff\xff\xff\xc0\xff\xff\xff\xa4\xff\xff\xff\xf4'] = 1,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x30\xff\xff\xff\xff'] = {
      ['\xff\xff\xff\x27\xff\xff\xff\xd7\xff\xff\xff\xa0\xff\xff\xff\xff'] = 1,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x38\xff\xff\xff\xff\xff\xff\xff\x0c'] = {
      ['\xff\xff\xff\x27\xff\xff\xff\xd5\xff\xff\xff\xbe\xff\xff\xff\xff\xff\xff\xff\x0c'] = 1,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\xff\xff\xff\xff\xd0'] = {
      ['\xff\xff\xff\x06\xff\xff\xff\x98\xff\xff\xff\xfe\xff\xff\xff\xff\xff\xff\xff\xd0'] = 1,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x94\xff\xff\xff\xa9\xff\xff\xff\x01\xff\xff\xff\x00'] = {
      ['\xff\xff\xff\x74\xff\xff\xff\x3d\xff\xff\xff\x02\xff\xff\xff\x78\xff\xff\xff\xc0'] = 2,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x99\xff\xff\xff\xa9\xff\xff\xff\x01\xff\xff\xff\x00\xff\xff\xff\x00'] = {
      ['\xff\xff\xff\x76\xff\xff\xff\x3c\xff\xff\xff\x02\xff\xff\xff\x85\xff\xff\xff\xcc\xff\xff\xff\x00'] = 2,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x8f\xff\xff\xff\xd7\xff\xff\xff\x13\xff\xff\xff\x00\xff\xff\xff\x00'] = {
      ['\xff\xff\xff\x91\xff\xff\xff\x93\xff\xff\xff\x29\xff\xff\xff\x27\xff\xff\xff\xbd\xff\xff\xff\xb8\xff\xff\xff\x00'] = 2,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x02\xff\xff\xff\x99\xff\xff\xff\xff\xff\xff\xff\x81\xff\xff\xff\x00\xff\xff\xff\x00'] = {
      ['\xff\xff\xff\xaf\xff\xff\xff\xfd\xff\xff\xff\xb2\xff\xff\xff\x87\xff\xff\xff\xcb\xff\xff\xff\xff\xff\xff\xff\x7e'] = 2,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x2f\xff\xff\xff\xe8'] = {
      ['\xff\xff\xff\x00\xff\xff\xff\x74\xff\xff\xff\x20\xff\xff\xff\x01\xff\xff\xff\x7a\xff\xff\xff\xc8'] = 3,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x3e\xff\xff\xff\xf3'] = {
      ['\xff\xff\xff\x37\xff\xff\xff\x63\xff\xff\xff\x0e\xff\xff\xff\x03\xff\xff\xff\x8a\xff\xff\xff\xd2'] = 3,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x4e\xff\xff\xff\xf5\xff\xff\xff\x01'] = {
      ['\xff\xff\xff\x52\xff\xff\xff\x7e\xff\xff\xff\x2f\xff\xff\xff\x23\xff\xff\xff\xab\xff\xff\xff\xd9\xff\xff\xff\x00'] = 3,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x17\xff\xff\xff\xff\xff\xff\xff\xbe'] = {
      ['\xff\xff\xff\x9b\xff\xff\xff\xdd\xff\xff\xff\x9d\xff\xff\xff\x83\xff\xff\xff\xc5\xff\xff\xff\xff\xff\xff\xff\x99'] = 3,
    },
    ['\xff\xff\xff\xfe\xff\xff\xff\xec\xff\xff\xff\xec\xff\xff\xff\xee\xff\xff\xff\xff\xff\xff\xff\xec'] = {
      ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x28\xff\xff\xff\xcb\xff\xff\xff\xf4\xff\xff\xff\x00'] = 4,
    },
    ['\xff\xff\xff\xfe\xff\xff\xff\xec\xff\xff\xff\xec\xff\xff\xff\xef\xff\xff\xff\xff\xff\xff\xff\xec\xff\xff\xff\xec'] = {
      ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x2f\xff\xff\xff\xce\xff\xff\xff\xff\xff\xff\xff\x00\xff\xff\xff\x00'] = 4,
    },
    ['\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff'] = {
      ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x77\xff\xff\xff\xc5\xff\xff\xff\xff\xff\xff\xff\x08'] = 4,
      ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x05\xff\xff\xff\xce\xff\xff\xff\xfc\xff\xff\xff\xff\xff\xff\xff\x00'] = 4,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x39\xff\xff\xff\xd9'] = {
      ['\xff\xff\xff\x00\xff\xff\xff\xc6\xff\xff\xff\x34\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00'] = 5,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x48\xff\xff\xff\xe3'] = {
      ['\xff\xff\xff\x45\xff\xff\xff\xd3\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00'] = 5,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x42\xff\xff\xff\xfc\xff\xff\xff\x04'] = {
      ['\xff\xff\xff\x00\xff\xff\xff\xc0\xff\xff\xff\x82\xff\xff\xff\x14\xff\xff\xff\x14\xff\xff\xff\x14\xff\xff\xff\x06\xff\xff\xff\x00'] = 5,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x16\xff\xff\xff\xff\xff\xff\xff\xc5'] = {
      ['\xff\xff\xff\x0c\xff\xff\xff\xff\xff\xff\xff\xbf\xff\xff\xff\x7c\xff\xff\xff\x7c\xff\xff\xff\x7c\xff\xff\xff\x0d'] = 5,
    },
    ['\xff\xff\xff\x07\xff\xff\xff\xf9\xff\xff\xff\x12\xff\xff\xff\x00\xff\xff\xff\x36\xff\xff\xff\xde'] = {
      ['\xff\xff\xff\x00\xff\xff\xff\x5b\xff\xff\xff\xca\xff\xff\xff\x20\xff\xff\xff\x00\xff\xff\xff\x02'] = 6,
    },
    ['\xff\xff\xff\x0a\xff\xff\xff\xfa\xff\xff\xff\x29\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x48\xff\xff\xff\xe6'] = {
      ['\xff\xff\xff\x00\xff\xff\xff\x3f\xff\xff\xff\xe6\xff\xff\xff\x4f\xff\xff\xff\x05\xff\xff\xff\x00\xff\xff\xff\x02'] = 6,
    },
    ['\xff\xff\xff\x2a\xff\xff\xff\xff\xff\xff\xff\x18\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x40\xff\xff\xff\xfc\xff\xff\xff\x01'] = {
      ['\xff\xff\xff\x00\xff\xff\xff\x2e\xff\xff\xff\xed\xff\xff\xff\x71\xff\xff\xff\x27\xff\xff\xff\x1a\xff\xff\xff\x0a\xff\xff\xff\x00'] = 6,
    },
    ['\xff\xff\xff\xef\xff\xff\xff\xe1\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x08\xff\xff\xff\xff\xff\xff\xff\xc4'] = {
      ['\xff\xff\xff\x04\xff\xff\xff\xcc\xff\xff\xff\xfb\xff\xff\xff\xad\xff\xff\xff\x84\xff\xff\xff\x88\xff\xff\xff\x09'] = 6,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\xab\xff\xff\xff\x88\xff\xff\xff\x00\xff\xff\xff\x00'] = {
      ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x71\xff\xff\xff\xb3'] = 7,
    },
    -- 7-medium is just the same as 7-small?
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x5f\xff\xff\xff\xd2\xff\xff\xff\x00\xff\xff\xff\x00'] = {
      ['\xff\xff\xff\x14\xff\xff\xff\x14\xff\xff\xff\x14\xff\xff\xff\x14\xff\xff\xff\x6c\xff\xff\xff\xc7'] = 7,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x2f\xff\xff\xff\xff\xff\xff\xff\xa5\xff\xff\xff\x00\xff\xff\xff\x00'] = {
      ['\xff\xff\xff\x7c\xff\xff\xff\x7c\xff\xff\xff\x7c\xff\xff\xff\x7c\xff\xff\xff\x80\xff\xff\xff\xfc\xff\xff\xff\xd7'] = 7,
    },
    ['\xff\xff\xff\x1a\xff\xff\xff\xfb\xff\xff\xff\x01\xff\xff\xff\x00\xff\xff\xff\x30\xff\xff\xff\xe7'] = {
      ['\xff\xff\xff\x08\xff\xff\xff\xf6\xff\xff\xff\x38\xff\xff\xff\x00\xff\xff\xff\x6d\xff\xff\xff\xce'] = 8,
    },
    ['\xff\xff\xff\x25\xff\xff\xff\xff\xff\xff\xff\x09\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x42\xff\xff\xff\xed'] = {
      ['\xff\xff\xff\x0f\xff\xff\xff\xfb\xff\xff\xff\x44\xff\xff\xff\x00\xff\xff\xff\x76\xff\xff\xff\xd7\xff\xff\xff\x00'] = 8,
    },
    ['\xff\xff\xff\x10\xff\xff\xff\xf8\xff\xff\xff\x47\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x8a\xff\xff\xff\xd2\xff\xff\xff\x00'] = {
      ['\xff\xff\xff\x0a\xff\xff\xff\xf0\xff\xff\xff\x8d\xff\xff\xff\x20\xff\xff\xff\x2b\xff\xff\xff\xb2\xff\xff\xff\xca\xff\xff\xff\x00'] = 8,
    },
    ['\xff\xff\xff\xcd\xff\xff\xff\xf4\xff\xff\xff\x1b\xff\xff\xff\x00\xff\xff\xff\x2b\xff\xff\xff\xf6\xff\xff\xff\xcb'] = {
      ['\xff\xff\xff\x96\xff\xff\xff\xff\xff\xff\xff\xc6\xff\xff\xff\x84\xff\xff\xff\xc6\xff\xff\xff\xff\xff\xff\xff\x97'] = 8,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x8d\xff\xff\xff\x9b'] = {
      ['\xff\xff\xff\x01\xff\xff\xff\xe5\xff\xff\xff\x4f\xff\xff\xff\x05\xff\xff\xff\x9b\xff\xff\xff\x70'] = 9,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\xb5\xff\xff\xff\x92'] = {
      ['\xff\xff\xff\x03\xff\xff\xff\xe3\xff\xff\xff\x74\xff\xff\xff\x02\xff\xff\xff\x19\xff\xff\xff\xc0\xff\xff\xff\x5e'] = 9,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x16\xff\xff\xff\x06\xff\xff\xff\x6c\xff\xff\xff\xcc\xff\xff\xff\x00'] = {
      ['\xff\xff\xff\x00\xff\xff\xff\xc7\xff\xff\xff\xb5\xff\xff\xff\x27\xff\xff\xff\x45\xff\xff\xff\xe8\xff\xff\xff\x5b\xff\xff\xff\x00'] = 9,
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x11\xff\xff\xff\x45\xff\xff\xff\x3b\xff\xff\xff\x0e\xff\xff\xff\xfa\xff\xff\xff\xb7'] = {
      ['\xff\xff\xff\x7d\xff\xff\xff\xff\xff\xff\xff\xc6\xff\xff\xff\x85\xff\xff\xff\xd9\xff\xff\xff\xfe\xff\xff\xff\x42'] = 9,
    },
    ['\xff\xff\xff\x24\xff\xff\xff\xf4\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x24\xff\xff\xff\xf4\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x24\xff\xff\xff\xf4'] = {
      ['\xff\xff\xff\x24\xff\xff\xff\xfe\xff\xff\xff\x78\xff\xff\xff\x02\xff\xff\xff\x6f\xff\xff\xff\xfa\xff\xff\xff\x76\xff\xff\xff\x02\xff\xff\xff\x70\xff\xff\xff\xcd'] = 'm',
    },
    ['\xff\xff\xff\x30\xff\xff\xff\xff\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x30\xff\xff\xff\xff\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x30\xff\xff\xff\xff'] = {
      ['\xff\xff\xff\x30\xff\xff\xff\xff\xff\xff\xff\x7e\xff\xff\xff\x02\xff\xff\xff\x78\xff\xff\xff\xfa\xff\xff\xff\x7a\xff\xff\xff\x02\xff\xff\xff\x7a\xff\xff\xff\xd8'] = 'm',
    },
    ['\xff\xff\xff\x38\xff\xff\xff\xff\xff\xff\xff\x0c\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x38\xff\xff\xff\xff\xff\xff\xff\x08\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x38\xff\xff\xff\xff\xff\xff\xff\x08'] = {
      ['\xff\xff\xff\x38\xff\xff\xff\xfe\xff\xff\xff\xc3\xff\xff\xff\x35\xff\xff\xff\x24\xff\xff\xff\xba\xff\xff\xff\xea\xff\xff\xff\xc6\xff\xff\xff\x34\xff\xff\xff\x24\xff\xff\xff\xb9\xff\xff\xff\xc7\xff\xff\xff\x00'] = 'm',
    },
    ['\xff\xff\xff\xff\xff\xff\xff\xd0\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\xff\xff\xff\xff\xd0\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\xff\xff\xff\xff\xd0'] = {
      ['\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xd9\xff\xff\xff\x89\xff\xff\xff\xcc\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xd6\xff\xff\xff\x88\xff\xff\xff\xcc\xff\xff\xff\xff\xff\xff\xff\x8d'] = 'm',
    },
    ['\xff\xff\xff\x24\xff\xff\xff\xf6\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x24\xff\xff\xff\xf4'] = {
      ['\xff\xff\xff\x24\xff\xff\xff\xf4\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00'] = 'h',
    },
    ['\xff\xff\xff\x30\xff\xff\xff\xff\xff\xff\xff\x02\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x30\xff\xff\xff\xff'] = {
      ['\xff\xff\xff\x30\xff\xff\xff\xff\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00'] = 'h',
    },
    ['\xff\xff\xff\x38\xff\xff\xff\xff\xff\xff\xff\x16\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x38\xff\xff\xff\xff\xff\xff\xff\x08'] = {
      ['\xff\xff\xff\x38\xff\xff\xff\xff\xff\xff\xff\x0c\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00'] = 'h',
    },
    -- no h-bold: don't think there's any way to get 'hr' in bold
    ['\xff\xff\xff\x24\xff\xff\xff\xf4\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00'] = {
      ['\xff\xff\xff\x24\xff\xff\xff\xf6\xff\xff\xff\xa8\xff\xff\xff\x08\xff\xff\xff\x00'] = 'r',
    },
    ['\xff\xff\xff\x30\xff\xff\xff\xff\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00'] = {
      ['\xff\xff\xff\x30\xff\xff\xff\xf8\xff\xff\xff\xba\xff\xff\xff\x10\xff\xff\xff\x01'] = 'r',
    },
    ['\xff\xff\xff\x38\xff\xff\xff\xff\xff\xff\xff\x0c\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00'] = {
      ['\xff\xff\xff\x38\xff\xff\xff\xf9\xff\xff\xff\xcd\xff\xff\xff\x45\xff\xff\xff\x1f\xff\xff\xff\x02'] = 'r',
    },
    -- no r-bold: don't think there's any way to get 'hr' in bold
    -- parentheses can only appear in bold
    ['\xff\xff\xff\xf7\xff\xff\xff\xd8\xff\xff\xff\x00\xff\xff\xff\x00'] = {
      ['\xff\xff\xff\x01\xff\xff\xff\xd0\xff\xff\xff\xda\xff\xff\xff\x03'] = '(',
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x09\xff\xff\xff\xff\xff\xff\xff\xc6'] = {
      ['\xff\xff\xff\x17\xff\xff\xff\xf8\xff\xff\xff\x9e\xff\xff\xff\x00'] = '(',
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x7e\xff\xff\xff\x82\xff\xff\xff\x05\xff\xff\xff\xf5\xff\xff\xff\x27\xff\xff\xff\x5e\xff\xff\xff\xcd'] = {
      ['\xff\xff\xff\x12\xff\xff\xff\xfc\xff\xff\xff\x1c\xff\xff\xff\x4d\xff\xff\xff\xde\xff\xff\xff\x00\xff\xff\xff\xa6\xff\xff\xff\x59\xff\xff\xff\x00\xff\xff\xff\x00'] = '%',
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x7c\xff\xff\xff\x7b\xff\xff\xff\x0f\xff\xff\xff\xfa\xff\xff\xff\x33\xff\xff\xff\x66\xff\xff\xff\xd9'] = {
      ['\xff\xff\xff\x1d\xff\xff\xff\xff\xff\xff\xff\x24\xff\xff\xff\x57\xff\xff\xff\xe8\xff\xff\xff\x00\xff\xff\xff\x9f\xff\xff\xff\x55\xff\xff\xff\x00\xff\xff\xff\x00'] = '%',
    },
    ['\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x0c\xff\xff\xff\x06\xff\xff\xff\x5c\xff\xff\xff\x8f\xff\xff\xff\x13\xff\xff\xff\xfa\xff\xff\xff\x38\xff\xff\xff\x6c\xff\xff\xff\xd9\xff\xff\xff\x00'] = {
      ['\xff\xff\xff\x07\xff\xff\xff\xef\xff\xff\xff\x6f\xff\xff\xff\x98\xff\xff\xff\xc0\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x91\xff\xff\xff\x5a\xff\xff\xff\x00\xff\xff\xff\x00\xff\xff\xff\x00'] = '%',
    },
    -- no %-bold: no way to get '%' in bold
  },
}
